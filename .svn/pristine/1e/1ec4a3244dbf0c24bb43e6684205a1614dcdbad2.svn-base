<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
	<link rel="stylesheet" type="text/css" href="../font/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="../css/shipping.css" />
    <style>
			html, body {
				background-color: #efefef;
			}
			header {
				height: 50px;
				line-height: 50px;
				width: 100%;
				margin-bottom: 5px;
			}
			.head-center {
				text-align: center;
			}
			.con {
				width: 85%;
				margin: 15px auto;
				padding: 3px 15px;
				background-color: #fff;
				border-radius: 10px;
			}
			.con > div:not(:nth-of-type(2)) {
				/* box-shadow: 2px 2px 2px #ccc; */
				border-radius: 5px;
				padding: 8px 15px;
				font-size: 15px;
			}
			.con .itemNum {
				height: 30px;
				line-height: 30px;
				color: #0b93eb;
			}
			.devAlert {
				height: 86px;
				background-color: #0b93eb;
				padding: 15px;
				color: #fff;
				box-sizing: border-box;
			}
			.alertMsg {
				font-size: 18px;
				height: 30px;
			}
			.alertAdvice {
				font-size: 14px;
				height: 30px;
				line-height: 30px;
			}
			.devItem {
				display: flex;
				height: auto;
				padding: 3px 15px;
				flex-direction: column;
				justify-content: space-around;
				background-color: #fff;
				border-radius: 10px;
				margin: 0px auto;
				font-size: 14px;
			}
			.itemHead {
				display: flex;
				justify-content: flex-start;
				font-size: 16px;
				color: #0b93eb;
			}
			/*.itemCon {
				font-size: 15px;
			}
			.device {
				color: #0b93eb;
			}
			.key {
				margin-right: 10px;
			}
			.devItem .key ,.zero tr:nth-child(1){
				color: #bbb;
			}
			.serPeople {
				display: flex;
				flex-direction: column;
				justify-content: space-around;
				height: 60px;
				margin-bottom: 15px;
			}
			.serPeople .key {
				color: #0b93eb;
			}
			.hadSer {
				height: 20px;
				width: 50%;
				line-height: 20px;
				margin: 30px auto;
				padding: 5px 10px;
				border-radius: 15px;
				background-color: #0b93eb;
				color: #fff;
				text-align: center;
			}
			.pop {
				position: fixed;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				background-color: rgba(0,0,0,0.5);
			}
			.tips {
				position: fixed;
				width: 300px;
				height: 100px;
				padding: 7px 15px;
				background-color: #fff;
				border-radius: 10px;
				top: calc(50% - 50px);
				left: calc(50% - 165px);
			}
			.tipsHead {
				text-align: center;
				height: 30px;
				line-height: 30px;
				margin-bottom: 10px;
				color: #0b93eb;
			}
			.zero{
				font-size: 14px;
				text-align:center;
			}
			.zero tr  td:not(:nth-of-type(1)){
				
				padding-left:6px;
			}
			.zero tr:not(:nth-of-type(1)){
				/*border:1px solid red;*/
				/*height:25px;
				line-height:25px;*/
				/*padding-top:10px;}*/
			
			/* .td1{
				border:1px solid red;
				margin-top:-10px;
			} */
			.submit{
				width:15%;
				height:15px;
				line-height: 15px;
				border: 1px solid #0b93eb;
				color:#fff;
				background-color:#0b93eb;
				margin:0 auto;
				text-align:center;
				margin-bottom: 12px;
			}
			.c_check{ width:16px; height:16px;float:left;  color:#fff;}
			input[type='checkbox']{
				-webkit-appearance: checkbox;
			}
			
		.devItem .reason:nth-child(1) span:nth-child(2),.aa{
				padding-left:1em;
			}
			
			.reason-hide .reason{
				margin: 10px 0;
			}
			.reason-hide .reason .reasonVal{
				padding:4px;
				vertical-align: top;
				border:1px solid #ddd;
			}
			.con textarea{
				padding:4px;
				width: 85%;
				vertical-align: top;
				border:1px solid #ddd;
				margin-left: 15px;
				margin-bottom: 8px;
			}
			.reason-hide .dev-infosub{
				display: flex;
				margin: auto;
				width: 80px;
				height: 30px;
				line-height: 20px;
				justify-content: space-around;
				color: #fff;
				background-color: #0b93eb;
				border-radius: 10px;
			}
			select{
				appearance:none;
				-moz-appearance:none;
				-webkit-appearance:none;
				background-color: #0b93eb;
				color: #fff;
				border: solid 1px #0b93eb;
				vertical-align: middle;
				margin-left: 10px;
			}
		.itema{
				margin-top:10px;
				width:calc(100% - 20px);
				margin:10px 10px 0px 10px;
				padding:15px 0px 15px 0px;
				height:auto;
				border:0px solid red;
				position: relative;background: #fff;border-radius: 8px;
			}
			.username{color:#0b93eb;}
			.showdetail{position:absolute;top:15px;right:5px;color:#0b93eb}
			.protect_time{
				
			}
			.info{width:100%;height:40px;display: flex;}
/*除最后一行和第一行*/			
			.lixi_tel,.equip_name,.fire_hot,.guige,.bore,.weibao_data_1,.weibao_data_2,.content{
				padding:8px 0px 8px 12px;
				
			}
			.extra_value .key{
				padding:5px 0px 5px 30px;
				font-size:14px;
			}
			.bb{border-bottom: 1px solid #e9e9e9;}
/*最后一行*/
			.lixi_add,.materia{padding:8px 0px 0px 12px;}
/*第一行*/			
			.equip_name,.equip_set,.extra_value,.extra_aa{padding:0px 0px 8px 12px;}
			.next{position: absolute;right:50px;color:#0b93eb}
			.value{position: absolute;right:10px;color:#a3a3a3;}
			.ke{color:#0b93eb;}
			.left img{
				width:40px;height:40px;border-radius: 20px;position: relative;left:10px;
			}
			.itemNum,.reason{padding-left:12px;}
			.right{
				width:calc(100% - 60px);
				border:0px solid red;
				padding-left:20px;
				font-size:14px;
			}
			.itema textarea{
				padding:4px;
				width: calc(100% - 20px);
				vertical-align: top;
				border:1px solid #ddd;
			}
			.my_icon3{color:#0b93eb;}
			.content{border:0px solid red;}
			.text{background:#f2f2f2;width:calc(100% - 32px);margin-right:12px;line-height:20px;padding:10px;color:#fff;}
			.submit{
				color:#fff;background: #0b93eb;width:30%;line-height:30px;height:30px;margin:15px auto;border-radius: 12px;
			}
			.detail{
				border:0px solid red;padding:4px 12px 0px 12px;color:#a3a3a3;font-size:14px;
			}
			#xuan{-moz-transform:rotate(90deg); -webkit-transform:rotate(90deg);}
			.tr{-moz-transform:rotate(-180deg); -webkit-transform:rotate(-180deg);}
			#confirm{color:#000}
		</style>
</head>
<body>
<header>
	<div class="head-center">
		<span >维保详情</span>
	</div>
	<div class="DIV_L" onclick="goBack()" tapmode>
		<i class="iconfont icon-back"></i>
	</div>
</header>
<!--订单信息-->
<div class="itema">
		<div class="info">
			<div class="left"><img src="../image/bg5.png" /></div>
			<div class="right">
				<div class="username" id="username">张大锤</div>
				<div class="protect_time hide" id="protect_time">预约维保时间：2019.01.23</div>
			</div>
		</div>	
		<div class="lixi_tel  kk bb">
			<span class="key">联系方式</span>
			<span class="value" id="lixi_tel">12723186</span>
		</div>
		<div class="lixi_add"><span class="key">联系地址</span><span class="value" id="address">浙江省德清县湖州市武康镇</span></div>
</div>
<!--设备名称-->
<div class="itema" >
		<div class="equip_name bb">
			<span>设备名称</span><span class="value ke" id="equip_name">光是暗红色的</span>
		</div>	
		<div class="lixi_tel  kk bb">
			<span class="key">设备型号</span>
			<span class="value" id="m_type">12723186</span>
		</div>
		<div class="lixi_add"><span class="key">设备维保期</span><span id="needs">需维保 </span></div>
</div>
<!--设备参数-->	
<div class="itema">
		<!--<div class="equip_set bb">
			<span>设备参数</span><span class="value" id="equip_set">光是暗红色的</span>
		</div>	-->
		<div class="extra_aa  kk bb">
			<span class="key">额定功率</span>
			<span class="value" id="extra_value">12723186</span>
		</div>
		<div class="fire_hot  kk bb">
			<span class="key">火力</span>
			<span class="value" id="fire_hot">12723186</span>
		</div>
		<div class="guige  kk bb">
			<span class="key">规格</span>
			<span class="value" id="guige">12723186</span>
		</div>
		<div class="bore  kk bb">
			<span class="key">炉膛口径</span>
			<span class="value" id="bore">127</span>
		</div>
		<div class="materia"><span class="key">材质</span><span class="value"id="xuan" onclick="showMateria()"><i class="iconfont icon-htbArrowright iconaa"></i> </div>
		<div class="detail hide" id="detail"><span class="" id="materia"> 优质SUS304-2B不锈钢板am你带什么哈尔的权利为广大龙泉街道和管理 </span></div>
</div>
<!--不一样部分     -->
<!--已报修-->
<div class="itema" id="breakreason" style="margin-bottom: 30px;">
		<div class="itemNum">
			<i class="iconfont icon-qianbi my_icon3"></i>
			<span class="itemNumKey">维保时间</span>
		</div>
		<div class="weibao_data_1  kk bb">
			<span class="key">上次维保时间</span>
			<span class="value" id="datafirst">12723186</span>
		</div>
		<div class="weibao_data_1  kk ">
			<span class="key">上次维保项目：</span>
		</div>
		<div id="check">
			<div class="extra_value  kk bb">
				<span class="key mm">线路检查</span>
				
			</div>
			<div class="extra_value  kk bb">
				<span class="key">燃气管路清洁</span>
			
			</div>
			<div class="extra_value  kk bb">
				<span class="key">水道管路清洁</span>
			</div>
		</div>
		<div class="weibao_data_2  kk ">
			<span class="key">下次维保时间</span>
			<span class="value" id="dataSecord">12723186</span>
		</div>
</div>
<!--未保修-->
<div class="itema hide" id="jiaoyan_div">
	<div class="itemNum">
			<i class="iconfont icon-qianbi my_icon3"></i>
			<span class="itemNumKey">设备编码校验</span>
	</div>
	<div class="content">
		<input type="text" id="confirm" class="text" placeholder="请输入编码校验"/>
	</div>
</div>
<div class="submit hide " onclick="jiyan()">校验设备</div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/lib/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../script/lib/fastclick.js"></script>
<script type="text/javascript" src="../script/lib/template.js"></script>
<script type="text/javascript">
		var userId = window.localStorage.getItem("userId");
		var URL = "";
		var id = 0;
		var now_type;
		var machine_id=0;
		$(function() {//消除300ms点击延迟
			FastClick.attach(document.body);
			
			
		});
		apiready = function() {
			id = api.pageParam.id;
			now_type = api.pageParam.now_type;
			if(now_type==1){
				$(".submit").removeClass("hide");
				$("#jiaoyan_div").removeClass("hide");
			}else{
				
				$(".reason").removeClass("hide");
			}
			URL=$api.URL();
			var header = $api.dom('header');
			//适配iOS 7+，Android 4.4+状态栏
			headerH = $api.fixStatusBar(header);
			
			get_info(); 
			get_AllM2();
		};
		
		function goBack() {
			api.closeWin()
		}
		
		
		function get_info(){
			api.ajax({
		      url : URL + 'index.php?app=boli_homepage&act=get_weibao_info',
		              method : 'post',
		              cache : false,
		              timeout : 30,
		              dataType : 'json',
		              returnAll : false,
		              data : {
		                      values : {
		                            id:id
		                             }
		                     }
		    },function(ret,err){
		    console.log(JSON.stringify(ret));
		      if(ret.done){
		      	var data_weibao_info=ret.retval;
		      		
		      		//用户信息
		      		$("#username").html(data_weibao_info.company_name);
		      		if(!data_weibao_info.add_time){
		      			//$("#protect_time").html("预约维保时间:"+formatDateTime(parseInt((data_weibao_info.factory_time))+7776000));
		      			$("#datafirst").html(formatDateTime(data_weibao_info.factory_time));
		      			$("#dataSecord").html(formatDateTime(parseInt((data_weibao_info.factory_time))+data_weibao_info.wb_day));
		      		}else{
		      			//$("#protect_time").html("预约维保时间:"+formatDateTime(parseInt((data_weibao_info.add_time))+7776000));
		      			$("#datafirst").html(formatDateTime(data_weibao_info.add_time));
		      			$("#dataSecord").html(formatDateTime(parseInt((data_weibao_info.add_time))+data_weibao_info.wb_day));
		      		}
		      		$("#lixi_tel").html(data_weibao_info.phone_tel);
		      		$("#lixi_address").html(data_weibao_info.address);
		      		$("#equip_name").html(data_weibao_info.machine_name);
		      		$("#m_type").html(data_weibao_info.type_name);
		      		$("#extra_value").html(data_weibao_info.power);
		      		$("#fire_hot").html(data_weibao_info.fire);
		      		$("#guige").html(data_weibao_info.cate_name);
		      		$("#bore").html(data_weibao_info.caliber);
		      		$("#materia").html(data_weibao_info.parameter);
		      		if(!data_weibao_info.is_have){
		      			$("#needs").html("需维保");
		      		}else{
		      			$("#needs").html("已维保");
		      		}
		      }else{
		      	api.toast({
                    msg: ret.msg,
                    duration: 2000,
                    location: 'middle'
       			});
       			return;
		      }
		    });
		}
		
		//获取上次维保项目
		function get_AllM2(){
			api.ajax({
		      url : URL + 'index.php?app=boli_homepage&act=get_AllM2',
		              method : 'post',
		              cache : false,
		              timeout : 30,
		              dataType : 'json',
		              returnAll : false,
		              data : {
			              values : {
			                            m_id:id
			                        }
		                     }
		    },function(ret,err){
		    console.log(JSON.stringify(ret));
		      if(ret.done){
		      		if(ret.retval.length==0){
		      			$("#check").html("系统没有找到上次维保项目");
		      			return;
		      		}
					var str='';
					$.each(ret.retval,function(i,item){
						str+='<div class="extra_value  kk bb">';
						str+='<span class="key mm">'+item.cate_name+'</span>';
						str+='</div>';
					})
			      	$("#check").html(str);
		      }else{
			      api.toast({
	                    msg:ret.msg,
	                    duration: 2000,
	                    location: 'middle'
	       			});
	       			return;
		      	}
		      });
		}
		
		
		
		
		
		var flag=0;
		function showMateria(){
			if(flag==0){
				$("#detail").removeClass('hide');
				$("#xuan").css("transform","rotate(90deg)");
				$("#xuan").css("-webkit-transform","rotate(90deg)");
				flag==1;
			}
			if(flag==1){
				$("#detail").addClass('hide');
				$("#xuan").css("-webkit-transform","rotate(-90deg)");
				flag==0;
			}
			
		}
		//切换类型
	    //校验
		function jiyan(){
			var jiaoyanVal=$("#confirm").val();

			 if(!jiaoyanVal){
            	api.toast({
                    msg: '请填写正确的设备编码',
                    duration: 2000,
                    location: 'middle'
       			});
       			return;
            }
			api.ajax({
					url : URL + 'index.php?app=boli_homepage&act=jiaoyan',
					method : 'post',
					timeout : 30,
					dataType : 'json',
					returnAll : false,
					data : {
						values:{
							m_id:id,
							addr_id:jiaoyanVal
						}
					}
				}, function(ret, err) {
				if(ret.done){
					api.openWin({
			            name: 'finishProtect',
			            url: './finishProtect.html',
			            bounces:false,
			            reload:true,
			            animation:{
			            	type:'push',
			            	subType:'from_right',
			            	duration : 300 //动画过渡时间，默认300毫秒
			            },
			            pageParam : {
							id : id
						}
		            });
				}else{
					api.alert({
					    title: '提示',
					    msg:ret.msg,
					}, function(ret, err) {
						
					});
				
				}
			})
			
			
		}
		// 
		
//		 var $goodCart = $(".c_check");
//		$.each($goodCart,function(index,value){
//        value.addEventListener("click",function(e){
//            if(e.target.checked === true&&btn){
//              this.canClick = true;
//              btn = false;//控制大盒子能否点击
//            }
//            //如果点击目标有checked属性，并且点击目标的canclick属性不为true，那就alert
//            if("checked" in e.target){
//              if(this.canClick){
//                if($(this).find(".c_check:checked").length===0){
//                  this.canClick=false;
//                  btn=true;
//                }
//                console.log(btn,"能结算")
//              }
//              else{
//                e.target.checked=false
//                console.log(btn,"bu能结算")
//              }
//            }
//          })
//      })
		
		
		function goZeroDetail(data){
			api.openWin({
	            name: 'zeroDetail',
	            url: './zeroDetail.html',
	            bounces:false,
	            reload:true,
	            animation:{
	            	type:'push',
	            	subType:'from_right',
	            	duration : 300 //动画过渡时间，默认300毫秒
	            },
	            pageParam : {
					data : data
				}
            });
		}
		//设备没有名称和没有编码时设置
		function sz(){

		if(machine_id==null){
			machine_id=0;
		}
		var machine_name=$("#devName").val();
		var addr_id=$("#devCode").val();
		if(machine_name==""||machine_name==null){
			api.toast({
                    msg: "请给设备取个名称",
                    duration: 2000,
                    location: 'middle'
       			});
       			return;
		}
		if(addr_id==""||addr_id==null){
			api.toast({
                    msg: "顺便填一下设备身份证号",
                    duration: 2000,
                    location: 'middle'
       			});
       			return;
		}
			api.ajax({
		      url : URL + 'index.php?app=boli_homepage&act=sz_weixiu',
		              method : 'post',
		              cache : false,
		              timeout : 30,
		              dataType : 'json',
		              returnAll : false,
		              data : {
		                      values : {
		                            machine_id:machine_id,
		                            machine_name:machine_name,
		                            addr_id:addr_id,
		                            weixiu_id:id
		                             }
		                     }
		    },function(ret,err){
		    console.log(JSON.stringify(ret));
		      if(ret.done){
				api.toast({
                    msg: ret.retval,
                    duration: 2000,
                    location: 'middle'
       			});
       			window.location.reload();
		      }else{
		      api.toast({
                    msg: ret.msg,
                    duration: 2000,
                    location: 'middle'
       			});
		      }
		      });
		}
		  //时间戳转换
  function formatDateTime(timeStamp) {
    var date = new Date();
    date.setTime(timeStamp * 1000);
    var y = date.getFullYear();
    var m = date.getMonth() + 1;
    m = m < 10 ? ('0' + m) : m;
    var d = date.getDate();
    d = d < 10 ? ('0' + d) : d;
    var h = date.getHours();
    h = h < 10 ? ('0' + h) : h;
    var minute = date.getMinutes();
    var second = date.getSeconds();
    minute = minute < 10 ? ('0' + minute) : minute;
    second = second < 10 ? ('0' + second) : second;
    //return y + '-' + m + '-' + d+' '+h+':'+minute+':'+second;
    return y+"-"+m+"-"+d;
};
</script>
</html>